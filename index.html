<!doctype html>
<html>
  <head>
    <title>Tetrad</title>
    <link id="favicon" rel="icon" type="image/png" href="./favicon-red.png" />
    <style>
      body{
        background-color: lightpink;
        transition:background-color 0.5s;
        -moz-transition:background-color 0.5s,opacity 2s;
        -webkit-transition:background-color 0.5s,opacity 2s;
        -o-transition:background-color 0.5s,opacity 2s;
        margin: auto;
      }
      img{
        padding-top: 10vh;
        height:80vh;
        max-width: 80vw;
        margin: 0 auto;
        display: block;
        opacity: 0;

      }
      img.fade-in {
          opacity: 1;
          -o-transition:opacity 2s;
          -moz-transition:opacity 2s;
          -webkit-transition:opacity 2s;
          transition: opacity 2s;
      }
      .fade-out{
        opacity: 0;
        -o-transition:opacity 1s;
        -moz-transition:opacity 1s;
        -webkit-transition:opacity 1s;
        transition: opacity 1s;
      }

      /*************************

      *****************************/
      @import url(https://fonts.googleapis.com/css?family=Fjalla+One);
      @font-face {
        font-family: 'viper';
        src: url('./public/viper.ttf') format('woff'),
          url('./public/viper.woff') format('truetype'),
          url('./.fonts/viper.ttf') format('woff'),
          url('./.fonts/viper.woff') format('truetype');
      }
    body {
      font-family: 'viper', sans-serif;
    }

    .container {
      transform: translate(-50%, -50%);
      top: 50%;
      left: 50%;
      display: block;
      position: absolute;
      max-width: 250px;
      min-width: 250px;
    }
    h1 {
      color: #2b9f5e;
      text-transform: uppercase;
      font-size: 42px;
      margin: 0;
      line-height: 100px;
      letter-spacing: 2px;
    }

    .title {
      transform: translateX(-50%) rotate(0deg);
      display: block;
      float: left;
      left: 50%;
      position: relative;
      opacity:0;
    }
    .title span {
      transform: skew(-10deg);
      display: block;
      float: left;
      text-shadow: #533d4a 1px 1px, #533d4a 2px 2px, #533d4a 3px 3px, #533d4a 4px 4px, #533d4a 5px 5px, #533d4a 6px 6px;
      min-width: 10px;
      min-height: 10px;
      position: relative;
    }

    .title:nth-child(1) {
      color: #e55643;
    }
    .title:nth-child(2) {
      color: #2b9f5e;
    }
    .title:nth-child(3) {
      color: #f1c83c;
    }
    .button {
        float: left;
        font-size: 28px;
        font-family: 'viper', sans-serif;
        position: relative;
        bottom: -65px;
        left: 50%;
        transform: translateX(-50%) rotate(0deg);
        color: #f1c83c;
        text-transform: uppercase;
        text-align: center;
        opacity: 0;
        visibility: hidden;
        cursor: pointer;
        text-shadow: #533d4a 1px 1px, #533d4a 2px 2px, #533d4a 3px 3px, #533d4a 4px 4px;
      }
      .button span {
        transform: skew(-10deg);
        display: block;
        float: left;
      }

    </style>
  </head>
  <body>
    <div>
      <img src="./public/bg.png" />
    </div>
    <section class="container">
      <h1>
        <span class="title">Make</span><br>
        <span class="title">Music</span>
        <span class="title">Together</span>
      </h1>
    <div class="button">begin</div>
    </section>
    <script src="/socket.io/socket.io.js"></script>
    <script src="./public/jquery-3.1.1.min.js"></script>
    <script src="./public/tone.js"></script>
    <script src="./public/subcollidor.js"></script>
    <script src="./public/randomColor.js"></script>
    <script src="./public/tween1-18.js"></script>
    <script src="./public/lettering.js"></script>

    <script>
        var socket = io();
        var isPlaying = false;
        var i;
        $(document).ready(function() {
          console.log("ready");
            socket.emit('connection');
            socket.emit('beat');
            $(".title").lettering();
            $(".button").lettering();
            $('body').css('background-color',
            randomColor({
              luminosity: 'bright',
              format: 'rgb'
            }));
        });

          socket.on('pulse',function(){
            //console.log('pulse');
          });
          var notes = (function(){
            if( navigator.userAgent.match(/Android/i)
            || navigator.userAgent.match(/webOS/i)
            || navigator.userAgent.match(/iPhone/i)
            || navigator.userAgent.match(/iPad/i)
            || navigator.userAgent.match(/iPod/i)
            || navigator.userAgent.match(/BlackBerry/i)
            || navigator.userAgent.match(/Windows Phone/i)
            ){
               i = Math.floor(Math.random() * (2 - 1 + 1)) + 1;
             } else {
               i = Math.floor(Math.random() * (3 - 1 + 1)) + 1;
             }

            if(i===1){
              return ["C4","E4","G4","A4","F4"].scramble();
            } else if(i===2){
              return ["E4","F4","E4","F3","C4"].scramble();
            } else if(i===3){
              return ["C3","E3","G3","A3","F3"].scramble();
            }
          })();
          var plucky = new Tone.PolySynth().toMaster();

          var patternOne = new Tone.Pattern(function(time, note){
              plucky.triggerAttackRelease(note, "@8n");
          }, notes,"upDown");
          patternOne.start(0);

          $(document).ready(function() {
            animation();
          }, 1000);

          $('.button').click(function() {
            $('.button').text("Waiting for my moment...");
            socket.on('sync', function(currentBeat){
              $('#favicon').attr("href","./favicon-green.png");
              $("img").addClass("fade-in");
              $(".container").addClass("fade-out");
              if(Tone.Transport.state === "stopped"){
                Tone.Transport.start('+0.1');
              } else {
                Tone.Transport.syncSignal;
                //console.log('sync');
              }
              $('body').css('background-color',
                randomColor({
                  luminosity: 'bright',
                  format: 'rgb'
                }));
              });
          });

          function animation() {
            var title1 = new TimelineMax();
            $('.title').css('opacity',1);
            title1.to(".button", 0, {visibility: 'hidden', opacity: 0})
            title1.staggerFromTo(".title span", 0.5,
            {ease: Back.easeOut.config(3), opacity: 0, bottom: -80},
            {ease: Back.easeOut.config(3), opacity: 1, bottom: 0}, 0.05);
            title1.to(".button", 1, {visibility: 'visible' ,opacity: 1})
          }
          if( navigator.userAgent.match(/Android/i)
          || navigator.userAgent.match(/webOS/i)
          || navigator.userAgent.match(/iPhone/i)
          || navigator.userAgent.match(/iPad/i)
          || navigator.userAgent.match(/iPod/i)
          || navigator.userAgent.match(/BlackBerry/i)
          || navigator.userAgent.match(/Windows Phone/i)
          ){
             $('.title').css('font-size','2em');
           }
    </script>
  </body>
</html>
