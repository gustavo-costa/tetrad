<!doctype html>
<html>
  <head>
    <title>Tetrad</title>
    <style>
      body{
        background-color: lightpink;
        transition:background-color 0.5s;
        max-width: 200px;
        margin: auto;
      }
      img{
        height:500px;
        max-height: 500px;
        margin: 0 auto;
        display: block;
      }
      div{
        width:200px;
      }
    </style>
  </head>
  <body>
    <div>
      <img src="./public/bg.png" />
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="./public/jquery-3.1.1.min.js"></script>
    <script src="./public/tone.js"></script>
    <script src="./public/subcollidor.js"></script>
    <script src="./public/randomColor.js"></script>
    <script>
        var socket = io();
        var isPlaying = false;
        var i;
        $(document).ready(function() {
          console.log("ready");
            socket.emit('connection');
            socket.emit('beat');

            $('body').css('background-color',
            randomColor({
               luminosity: 'bright',
               format: 'rgb'
            }));
        });
          socket.on('sync', function(currentBeat){
            if(Tone.Transport.state === "stopped"){
              Tone.Transport.start('+0.1');
            } else {
              Tone.Transport.syncSignal;
              //console.log('sync');
            }
            $('body').css('background-color',
            randomColor({
               luminosity: 'bright',
               format: 'rgb'
            }));
          });
          socket.on('pulse',function(){
            //console.log('pulse');
          });
          var notes = (function(){
            if( navigator.userAgent.match(/Android/i)
            || navigator.userAgent.match(/webOS/i)
            || navigator.userAgent.match(/iPhone/i)
            || navigator.userAgent.match(/iPad/i)
            || navigator.userAgent.match(/iPod/i)
            || navigator.userAgent.match(/BlackBerry/i)
            || navigator.userAgent.match(/Windows Phone/i)
            ){
               i = Math.floor(Math.random() * (2 - 1 + 1)) + 1;
             } else {
               i = Math.floor(Math.random() * (3 - 1 + 1)) + 1;
             }

            if(i===1){
              return ["C4","E4","G4","A4","F4"];
            } else if(i===2){
              return ["E4","F4","E4","F3","C4"];
            } else{
              return ["C3","E3","G3","A3","F3"];
            }
          })();
            var plucky = new Tone.PolySynth().toMaster();
            var patternOne = new Tone.Pattern(function(time, note){
                plucky.triggerAttackRelease(note, "@8n");
            }, notes.scramble(),"upDown");
            patternOne.start(0);
            var drum = new Tone.MembraneSynth().toMaster();
            var drumPattern = new Tone.Pattern(function(time, note){
                drum.triggerAttackRelease(note, "@8n");
            }, ["C3","C3","C3","C3","C3"],"upDown");
            drumPattern.start(0);


    </script>
  </body>
</html>
